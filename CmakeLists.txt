cmake_minimum_required(VERSION 3.16)
project(MyApp)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)


# Dodaj katalog źródłowy
include_directories(src)

# Znajdź Catch2
find_package(Catch2 3 REQUIRED)

# Znajdź cpr
# Znajdź json
list(APPEND CMAKE_PREFIX_PATH
    /opt/homebrew/Cellar/cpr/1.11.2
    /opt/homebrew/Cellar/nlohmann-json/3.12.0
)

find_package(cpr REQUIRED)
find_package(nlohmann_json REQUIRED)

# Twoja biblioteka
add_subdirectory(src)


# Główna aplikacja
add_executable(app app/main.cpp)
target_link_libraries(app PRIVATE apikey_lib cpr::cpr)

# Testy
add_executable(tests tests/test.cpp)
target_link_libraries(tests PRIVATE Catch2::Catch2WithMain apikey_lib)

# Włączenie testów CTest + automatyczna rejestracja testów
enable_testing()
include(CTest)
include(Catch)
catch_discover_tests(tests)